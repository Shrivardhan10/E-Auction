<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bidder Dashboard — E-Auction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        body {
            background: #f4f5f7;
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #1e293b; margin: 0;
        }

        .top-bar {
            background: #fff; border-bottom: 1px solid #e2e8f0;
            padding: 14px 32px; display: flex; align-items: center;
            justify-content: space-between; position: sticky; top: 0; z-index: 50;
        }
        .top-bar .brand {
            font-weight: 700; font-size: 18px; color: #2563eb;
            display: flex; align-items: center; gap: 8px; text-decoration: none;
        }
        .top-bar .user-info {
            display: flex; align-items: center; gap: 16px;
            font-size: 14px; color: #64748b;
        }
        .top-bar .user-info a {
            color: #2563eb; text-decoration: none; font-weight: 500; transition: color .2s;
        }
        .top-bar .user-info a:hover { color: #1d4ed8; }

        .page-wrap { max-width: 1200px; margin: 0 auto; padding: 32px 24px 80px; }

        .greeting { margin-bottom: 32px; }
        .greeting h1 { font-size: 26px; font-weight: 700; color: #0f172a; margin: 0 0 4px; }
        .greeting p { color: #64748b; font-size: 15px; margin: 0; }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px; margin-bottom: 40px;
        }
        .stat {
            background: #fff; border-radius: 12px; padding: 22px;
            border: 1px solid #e2e8f0; transition: box-shadow .2s;
        }
        .stat:hover { box-shadow: 0 4px 12px rgba(0,0,0,.06); }
        .stat .icon-wrap {
            width: 40px; height: 40px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; margin-bottom: 14px;
        }
        .stat .label { font-size: 12px; text-transform: uppercase; letter-spacing: .5px; color: #94a3b8; font-weight: 600; }
        .stat .number { font-size: 26px; font-weight: 700; margin-top: 4px; color: #0f172a; }
        .stat.live .icon-wrap { background: #dcfce7; color: #16a34a; }
        .stat.bids .icon-wrap { background: #dbeafe; color: #2563eb; }
        .stat.won .icon-wrap { background: #f3e8ff; color: #7c3aed; }

        .section-head {
            font-size: 18px; font-weight: 700; color: #0f172a; margin-bottom: 16px;
            display: flex; align-items: center; gap: 8px;
        }
        .section-head i { color: #94a3b8; }

        /* Auction Cards */
        .auction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(310px, 1fr));
            gap: 20px; margin-bottom: 40px;
        }
        .auc-card {
            background: #fff; border: 1px solid #e2e8f0; border-radius: 12px;
            overflow: hidden; transition: box-shadow .2s, transform .2s;
        }
        .auc-card:hover { box-shadow: 0 6px 16px rgba(0,0,0,.08); transform: translateY(-2px); }
        .auc-card-img { width: 100%; height: 180px; object-fit: cover; display: block; }
        .auc-card-body { padding: 18px; }
        .auc-card-body h5 { font-size: 16px; font-weight: 700; margin: 0 0 10px; color: #0f172a; }
        .auc-meta { display: flex; justify-content: space-between; align-items: center; font-size: 13px; color: #64748b; margin-bottom: 8px; }
        .pill-live {
            background: #dcfce7; color: #166534; padding: 3px 10px;
            border-radius: 100px; font-size: 11px; font-weight: 600;
            display: inline-flex; align-items: center; gap: 4px;
        }
        .pill-live i { font-size: 8px; }
        .price-current { font-size: 20px; font-weight: 700; color: #2563eb; }
        .time-left { font-size: 12px; color: #94a3b8; }

        .bid-row { display: flex; gap: 8px; margin-top: 14px; }
        .bid-row input {
            flex: 1; border: 1px solid #e2e8f0; border-radius: 8px;
            padding: 9px 12px; font-size: 14px; outline: none; transition: border-color .2s;
            font-family: inherit;
        }
        .bid-row input:focus { border-color: #2563eb; }
        .bid-row .btn-bid {
            background: #2563eb; color: #fff; border: none; border-radius: 8px;
            padding: 9px 18px; font-weight: 600; font-size: 13px;
            cursor: pointer; transition: background .2s; white-space: nowrap;
        }
        .bid-row .btn-bid:hover { background: #1d4ed8; }
        .bid-row .btn-bid:disabled { opacity: .6; cursor: not-allowed; }

        .bid-hint {
            font-size: 11px; color: #94a3b8; margin-top: 6px;
        }

        /* History table */
        .card-table {
            background: #fff; border: 1px solid #e2e8f0; border-radius: 12px;
            overflow: hidden; margin-bottom: 40px;
        }
        .card-table table { width: 100%; margin: 0; border-collapse: collapse; }
        .card-table thead th {
            font-size: 11px; text-transform: uppercase; letter-spacing: .5px;
            color: #94a3b8; font-weight: 600; padding: 14px 16px;
            background: #f8fafc; border-bottom: 1px solid #e2e8f0; text-align: left;
        }
        .card-table tbody td {
            padding: 14px 16px; border-bottom: 1px solid #f1f5f9;
            font-size: 14px; vertical-align: middle;
        }
        .card-table tbody tr:last-child td { border-bottom: none; }
        .card-table tbody tr:hover { background: #f8fafc; }

        .empty-box { text-align: center; padding: 48px 20px; color: #94a3b8; }
        .empty-box i { font-size: 40px; margin-bottom: 12px; display: block; }
        .empty-box h5 { color: #475569; font-size: 16px; margin-bottom: 4px; }
        .empty-box p { font-size: 14px; margin: 0; }

        .alert { border-radius: 10px; border: none; font-size: 14px; }

        @media (max-width: 768px) {
            .page-wrap { padding: 20px 16px 60px; }
            .greeting h1 { font-size: 22px; }
            .stats-row { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .auction-grid { grid-template-columns: 1fr; }
            .top-bar { padding: 12px 16px; }
        }
    </style>
</head>
<body>
    <header class="top-bar">
        <a class="brand" href="/bidder/dashboard">
            <i class="bi bi-hammer"></i> E-Auction Bidder
        </a>
        <div class="user-info">
            <a href="/bidder/auctions" style="color:#2563eb;text-decoration:none;font-weight:600"><i class="bi bi-broadcast"></i> Auctions</a>
            <span><i class="bi bi-person-circle"></i> <span th:text="${user.name}">Bidder</span></span>
            <a href="/logout"><i class="bi bi-box-arrow-right"></i> Sign out</a>
        </div>
    </header>

    <div class="page-wrap">
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i><span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-circle-fill me-2"></i><span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div class="greeting">
            <h1>Hey, <span th:text="${user.name}">Bidder</span></h1>
            <p>Discover rare collectibles and place your bids.</p>
        </div>

        <div class="stats-row">
            <div class="stat live">
                <div class="icon-wrap"><i class="bi bi-broadcast"></i></div>
                <div class="label">Live Auctions</div>
                <div class="number" th:text="${liveAuctions}">0</div>
            </div>
            <div class="stat bids">
                <div class="icon-wrap"><i class="bi bi-hand-index-thumb"></i></div>
                <div class="label">My Total Bids</div>
                <div class="number" th:text="${totalBids}">0</div>
            </div>
            <div class="stat won">
                <div class="icon-wrap"><i class="bi bi-trophy"></i></div>
                <div class="label">Auctions Won</div>
                <div class="number" th:text="${auctionsWon}">0</div>
            </div>
        </div>

        <!-- Auctions Won -->
        <h2 class="section-head"><i class="bi bi-trophy"></i> Auctions Won</h2>

        <div class="auction-grid" th:if="${wonAuctionsList != null and !wonAuctionsList.isEmpty()}">
            <a th:each="entry : ${wonAuctionsList}" th:href="@{'/bidder/auction/' + ${entry.auction.auctionId}}"
               class="auc-card" style="text-decoration:none;color:inherit;">
                <img th:if="${entry.item.imageData != null}" th:src="@{'/api/items/' + ${entry.item.itemId} + '/image'}" alt="Item"
                     class="auc-card-img" onerror="this.src='https://via.placeholder.com/320x180?text=No+Image'">
                <div th:if="${entry.item.imageData == null}" class="auc-card-img" style="display:flex;align-items:center;justify-content:center;background:#f1f5f9">
                    <i class="bi bi-image" style="font-size:36px;color:#cbd5e1"></i>
                </div>
                <div class="auc-card-body">
                    <div class="auc-meta">
                        <span style="background:#f3e8ff;color:#7c3aed;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600;display:inline-flex;align-items:center;gap:4px;">
                            <i class="bi bi-trophy-fill"></i> WON
                        </span>
                        <span class="time-left" th:text="${#temporals.format(entry.auction.endTime, 'dd MMM yyyy')}">--</span>
                    </div>
                    <h5 th:text="${entry.item.name != null ? entry.item.name : 'Auction Item'}">Item</h5>
                    <div class="auc-meta" style="margin-bottom:0;">
                        <span>Winning Bid</span>
                        <span class="price-current" th:text="${entry.auction.currentHighestBid != null ? '₹' + #numbers.formatDecimal(entry.auction.currentHighestBid, 1, 2) : '—'}">—</span>
                    </div>
                </div>
            </a>
        </div>

        <div th:if="${wonAuctionsList == null or wonAuctionsList.isEmpty()}">
            <div class="empty-box" style="background:#fff;border:1px solid #e2e8f0;border-radius:12px;">
                <i class="bi bi-trophy"></i>
                <h5>No auctions won yet</h5>
                <p>Participate in live auctions to win items.</p>
            </div>
        </div>

        <!-- Auctions Participated -->
        <h2 class="section-head" style="margin-top:40px;"><i class="bi bi-hand-index-thumb"></i> Auctions Participated</h2>

        <div class="auction-grid" th:if="${participatedList != null and !participatedList.isEmpty()}">
            <a th:each="entry : ${participatedList}" th:href="@{'/bidder/auction/' + ${entry.auction.auctionId}}"
               class="auc-card" style="text-decoration:none;color:inherit;">
                <img th:if="${entry.item.imageData != null}" th:src="@{'/api/items/' + ${entry.item.itemId} + '/image'}" alt="Item"
                     class="auc-card-img" onerror="this.src='https://via.placeholder.com/320x180?text=No+Image'">
                <div th:if="${entry.item.imageData == null}" class="auc-card-img" style="display:flex;align-items:center;justify-content:center;background:#f1f5f9">
                    <i class="bi bi-image" style="font-size:36px;color:#cbd5e1"></i>
                </div>
                <div class="auc-card-body">
                    <div class="auc-meta">
                        <span th:if="${entry.auction.status == 'LIVE'}" class="pill-live"><i class="bi bi-circle-fill"></i> LIVE</span>
                        <span th:if="${entry.auction.status == 'COMPLETED'}" style="background:#e2e8f0;color:#475569;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600;">COMPLETED</span>
                        <span th:if="${entry.auction.status == 'PENDING'}" style="background:#fef3c7;color:#92400e;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600;">PENDING</span>
                    </div>
                    <h5 th:text="${entry.item.name != null ? entry.item.name : 'Auction Item'}">Item</h5>
                    <div class="auc-meta" style="margin-bottom:0;">
                        <span>My Highest Bid</span>
                        <span style="font-weight:700;color:#2563eb;" th:text="'₹' + ${#numbers.formatDecimal(entry.myHighestBid, 1, 2)}">—</span>
                    </div>
                </div>
            </a>
        </div>

        <div th:if="${participatedList == null or participatedList.isEmpty()}">
            <div class="empty-box" style="background:#fff;border:1px solid #e2e8f0;border-radius:12px;">
                <i class="bi bi-hand-index-thumb"></i>
                <h5>No auction participation yet</h5>
                <p><a href="/bidder/auctions" style="color:#2563eb;">Browse live auctions</a> to start bidding.</p>
            </div>
        </div>

        <!-- Recent Bid History -->
        <h2 class="section-head" style="margin-top:40px;"><i class="bi bi-clock-history"></i> My Recent Bids</h2>

        <div class="card-table" th:if="${recentBids != null and !recentBids.isEmpty()}">
            <table>
                <thead>
                    <tr>
                        <th>Auction ID</th>
                        <th>Bid Amount</th>
                        <th>Placed At</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="bid : ${recentBids}">
                        <td><code style="background:#f1f5f9;padding:2px 8px;border-radius:4px;font-size:12px;" th:text="${#strings.abbreviate(bid.auctionId.toString(), 12)}">abc123</code></td>
                        <td style="font-weight:600;">&#8377;<span th:text="${#numbers.formatDecimal(bid.amount, 1, 2)}">0.00</span></td>
                        <td style="color:#94a3b8;font-size:13px;" th:text="${#temporals.format(bid.createdAt, 'dd MMM yyyy, HH:mm')}">01 Jan 2026</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div th:if="${recentBids == null or recentBids.isEmpty()}">
            <div class="empty-box" style="background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:30px;">
                <i class="bi bi-hand-index-thumb"></i>
                <p>You haven't placed any bids yet. Browse live auctions above.</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
