<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Auction Monitor — Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{box-sizing:border-box}
        body{background:#f4f5f7;min-height:100vh;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;color:#1e293b;margin:0}

        .top-bar{background:#fff;border-bottom:1px solid #e2e8f0;padding:14px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
        .top-bar .brand{font-weight:700;font-size:18px;color:#2563eb;display:flex;align-items:center;gap:8px;text-decoration:none}
        .top-bar .nav-links{display:flex;align-items:center;gap:20px;font-size:14px}
        .top-bar .nav-links a{color:#64748b;text-decoration:none;font-weight:500;transition:color .2s}
        .top-bar .nav-links a:hover,.top-bar .nav-links a.active{color:#2563eb}
        .top-bar .user-info{display:flex;align-items:center;gap:16px;font-size:14px;color:#64748b}
        .top-bar .user-info a{color:#2563eb;text-decoration:none;font-weight:500}

        .page-wrap{max-width:1200px;margin:0 auto;padding:32px 24px 80px}
        .page-title{font-size:26px;font-weight:700;color:#0f172a;margin:0 0 4px}
        .page-subtitle{color:#64748b;font-size:15px;margin:0 0 28px}

        .filter-row{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}
        .pill{padding:7px 18px;border-radius:100px;border:1px solid #e2e8f0;background:#fff;color:#64748b;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}
        .pill:hover{border-color:#2563eb;color:#2563eb}
        .pill.active{background:#2563eb;color:#fff;border-color:#2563eb}

        .section-head{font-size:18px;font-weight:700;color:#0f172a;margin:24px 0 14px;display:flex;align-items:center;gap:8px}
        .section-head i{color:#94a3b8}
        .count-badge{background:#e2e8f0;color:#475569;font-size:12px;font-weight:600;padding:2px 10px;border-radius:100px;margin-left:6px}

        .auction-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:20px;margin-bottom:32px}
        .auc-card{background:#fff;border:1px solid #e2e8f0;border-radius:12px;overflow:hidden;transition:box-shadow .2s,transform .2s}
        .auc-card:hover{box-shadow:0 6px 16px rgba(0,0,0,.08);transform:translateY(-2px)}
        .auc-card-img{width:100%;height:160px;object-fit:cover;display:block;background:#f1f5f9}
        .auc-card-body{padding:18px}
        .auc-card-body h5{font-size:16px;font-weight:700;margin:0 0 8px;color:#0f172a}
        .auc-meta{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#64748b;margin-bottom:8px}
        .pill-live{background:#dcfce7;color:#166534;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600;display:inline-flex;align-items:center;gap:4px}
        .pill-live i{font-size:8px}
        .pill-pending{background:#fef3c7;color:#92400e;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600}
        .pill-completed{background:#e2e8f0;color:#475569;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600}
        .price-current{font-size:20px;font-weight:700;color:#2563eb}
        .bid-count{font-size:12px;color:#94a3b8}
        .btn-monitor{display:block;width:100%;margin-top:14px;background:#0f172a;color:#fff;border:none;border-radius:8px;padding:10px;font-weight:600;font-size:14px;cursor:pointer;text-align:center;text-decoration:none;transition:background .2s}
        .btn-monitor:hover{background:#1e293b;color:#fff}

        .empty-state{text-align:center;padding:48px 24px;color:#94a3b8}
        .empty-state i{font-size:40px;margin-bottom:12px;display:block}
    </style>
</head>
<body>

<div class="top-bar">
    <a th:href="@{/admin/dashboard(token=${token})}" class="brand"><i class="bi bi-shield-lock"></i> E-Auction Admin</a>
    <div class="nav-links">
        <a th:href="@{/admin/dashboard(token=${token})}">Dashboard</a>
        <a th:href="@{/admin/auctions(token=${token})}" class="active">Auctions</a>
    </div>
    <div class="user-info">
        <span th:text="${user.name}">Admin</span>
        <a th:href="@{/logout(token=${token})}"><i class="bi bi-box-arrow-right"></i> Logout</a>
    </div>
</div>

<div class="page-wrap">
    <h1 class="page-title">Auction Monitor</h1>
    <p class="page-subtitle">Track all auctions in real-time.</p>

    <div class="filter-row">
        <button class="pill active" onclick="filterAuctions('all')">All</button>
        <button class="pill" onclick="filterAuctions('live')">Live</button>
        <button class="pill" onclick="filterAuctions('pending')">Pending</button>
        <button class="pill" onclick="filterAuctions('completed')">Completed</button>
    </div>

    <!-- LIVE -->
    <div id="liveSection">
        <div class="section-head"><i class="bi bi-broadcast"></i> Live <span class="count-badge" th:text="${#lists.size(liveAuctions)}">0</span></div>
        <div class="auction-grid" th:if="${#lists != null && !#lists.isEmpty(liveAuctions)}">
            <div class="auc-card" th:each="entry : ${liveAuctions}">
                <img th:if="${entry.item != null && entry.item.imageData != null}" th:src="@{'/api/items/' + ${entry.item.itemId} + '/image'}" class="auc-card-img" alt="Item">
                <div th:if="${entry.item == null || entry.item.imageData == null}" class="auc-card-img" style="display:flex;align-items:center;justify-content:center;background:#f1f5f9"><i class="bi bi-image" style="font-size:36px;color:#cbd5e1"></i></div>
                <div class="auc-card-body">
                    <div class="auc-meta"><span class="pill-live"><i class="bi bi-circle-fill"></i> LIVE</span><span class="bid-count" th:text="${entry.bidCount} + ' bids'">0</span></div>
                    <h5 th:text="${entry.item != null ? entry.item.name : 'Item'}">Item</h5>
                    <div class="price-current">₹<span th:text="${entry.currentHighest != null ? entry.currentHighest : 0}">0</span></div>
                    <a th:href="@{'/admin/auction/' + ${entry.auction.auctionId} + '?token=' + ${token}}" class="btn-monitor">Monitor</a>
                </div>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(liveAuctions)}" class="empty-state"><i class="bi bi-broadcast"></i><p>No live auctions</p></div>
    </div>

    <!-- PENDING -->
    <div id="pendingSection">
        <div class="section-head"><i class="bi bi-clock"></i> Pending <span class="count-badge" th:text="${#lists.size(pendingAuctions)}">0</span></div>
        <div class="auction-grid" th:if="${#lists != null && !#lists.isEmpty(pendingAuctions)}">
            <div class="auc-card" th:each="entry : ${pendingAuctions}">
                <img th:if="${entry.item != null && entry.item.imageData != null}" th:src="@{'/api/items/' + ${entry.item.itemId} + '/image'}" class="auc-card-img" alt="Item">
                <div th:if="${entry.item == null || entry.item.imageData == null}" class="auc-card-img" style="display:flex;align-items:center;justify-content:center;background:#f1f5f9"><i class="bi bi-image" style="font-size:36px;color:#cbd5e1"></i></div>
                <div class="auc-card-body">
                    <div class="auc-meta"><span class="pill-pending">PENDING</span></div>
                    <h5 th:text="${entry.item != null ? entry.item.name : 'Item'}">Item</h5>
                    <div style="font-size:13px;color:#64748b">Starts: <span th:text="${#temporals.format(entry.auction.startTime, 'MMM dd, hh:mm a')}">--</span></div>
                    <a th:href="@{'/admin/auction/' + ${entry.auction.auctionId} + '?token=' + ${token}}" class="btn-monitor">View</a>
                </div>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(pendingAuctions)}" class="empty-state"><i class="bi bi-clock"></i><p>No pending auctions</p></div>
    </div>

    <!-- COMPLETED -->
    <div id="completedSection">
        <div class="section-head"><i class="bi bi-check-circle"></i> Completed <span class="count-badge" th:text="${#lists.size(completedAuctions)}">0</span></div>
        <div class="auction-grid" th:if="${#lists != null && !#lists.isEmpty(completedAuctions)}">
            <div class="auc-card" th:each="entry : ${completedAuctions}">
                <img th:if="${entry.item != null && entry.item.imageData != null}" th:src="@{'/api/items/' + ${entry.item.itemId} + '/image'}" class="auc-card-img" alt="Item">
                <div th:if="${entry.item == null || entry.item.imageData == null}" class="auc-card-img" style="display:flex;align-items:center;justify-content:center;background:#f1f5f9"><i class="bi bi-image" style="font-size:36px;color:#cbd5e1"></i></div>
                <div class="auc-card-body">
                    <div class="auc-meta"><span class="pill-completed">COMPLETED</span><span class="bid-count" th:text="${entry.bidCount} + ' bids'">0</span></div>
                    <h5 th:text="${entry.item != null ? entry.item.name : 'Item'}">Item</h5>
                    <div class="price-current">₹<span th:text="${entry.currentHighest != null ? entry.currentHighest : 0}">0</span></div>
                    <div style="font-size:13px;color:#64748b;margin-top:6px;">
                        <div th:if="${entry.winnerName != null}"><i class="bi bi-trophy-fill" style="color:#d97706;"></i> Winner: <strong th:text="${entry.winnerName}">—</strong></div>
                        <div th:if="${entry.sellerName != null}"><i class="bi bi-person" style="color:#64748b;"></i> Seller: <span th:text="${entry.sellerName}">—</span></div>
                        <div th:if="${entry.paymentStatus != null}"><i class="bi bi-credit-card" style="color:#64748b;"></i> Payment:
                            <span th:if="${entry.paymentStatus == 'SUCCESS'}" style="color:#16a34a;font-weight:600;">Paid</span>
                            <span th:if="${entry.paymentStatus == 'PENDING'}" style="color:#d97706;font-weight:600;">Pending</span>
                            <span th:if="${entry.paymentStatus == 'FAILED'}" style="color:#dc2626;font-weight:600;">Failed</span>
                        </div>
                        <div th:if="${entry.winnerName == null}" style="color:#94a3b8;">No bids placed</div>
                    </div>
                    <a th:href="@{'/admin/auction/' + ${entry.auction.auctionId} + '?token=' + ${token}}" class="btn-monitor" style="margin-top:10px;">View Details</a>
                </div>
            </div>
        </div>
        <div th:if="${#lists.isEmpty(completedAuctions)}" class="empty-state"><i class="bi bi-check-circle"></i><p>No completed auctions</p></div>
    </div>
</div>

<script>
function filterAuctions(type) {
    document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('liveSection').style.display = (type === 'all' || type === 'live') ? '' : 'none';
    document.getElementById('pendingSection').style.display = (type === 'all' || type === 'pending') ? '' : 'none';
    document.getElementById('completedSection').style.display = (type === 'all' || type === 'completed') ? '' : 'none';
}
setInterval(() => location.reload(), 15000);
</script>

</body>
</html>
